name: Gitea Actions DinD Test

on: [push]

jobs:
  check-docker:
    # 确保这里的 labels 与你 runner 注册时的 labels 一致
    # 默认通常是 ubuntu-latest, self-hosted 或者在 config 中定义的 labels
    runs-on: ubuntu-latest 

    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: 1. 检查环境变量
        run: |
          echo "Checking DOCKER_HOST..."
          echo "DOCKER_HOST is: $DOCKER_HOST"

      - name: 2. 检查 Docker Daemon 连接
        run: |
          docker info

      - name: 3. 测试运行容器 (Hello World)
        run: |
          docker run --rm alpine echo "Hello from DinD! Docker is working correctly."

      - name: 4. 测试构建镜像 (Optional)
        run: |
          echo "FROM alpine" > Dockerfile
          echo "RUN echo 'Built inside Gitea Actions'" >> Dockerfile
          docker build -t test-image:latest .
          docker images | grep test-image